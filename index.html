<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Trading Journal</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="main-container">
        <h1>QC Trading Journal</h1>
        <div class="journal-container">
            <img id="logo" src="QCpurpbsee.png" alt="Logo">
            <form id="journal-form">
                <div id="local-time" style="text-align: center;"></div>
                <input type="text" id="symbol-name" placeholder="Symbol Name" required>
                <input type="datetime-local" id="entry-time" required>
                <input type="datetime-local" id="exit-time" required>
                <input type="number" id="entry-price" placeholder="Entry Price" required>
                <input type="number" id="exit-price" placeholder="Exit Price" required>
                <select id="side" required>
                    <option value="long">Long</option>
                    <option value="short">Short</option>
                </select>
                <textarea id="question-1" placeholder="How did you feel during this trade?" required></textarea>
                <textarea id="question-2" placeholder="What strategy did you use? Did it change from your previous trade?" required></textarea>
                <textarea id="question-3" placeholder="What's your opinion on how the trade played out?" required></textarea>
                <button id="submit-entry">Submit Entry</button>
                <button id="delete-selected">Delete Selected Entries</button>
                <button id="submit-selected">Download Selected Entries</button>
                <button id="select-all">Select All</button>
            </form>
            <div id="past-entries">
                <!-- Past entries will be shown here -->
            </div>
        </div>
    </div>

    <script>
        // Function to update time
        function updateTime() {
            var currentTime = new Date().toLocaleString();
            document.getElementById('local-time').textContent = currentTime;
        }

        // Update time every second
        setInterval(updateTime, 1000);

        // Call updateTime once to display the time immediately
        updateTime();

        // Function to get today's date in the format YYYY-MM-DD
        function getTodayDate() {
            var today = new Date();
            var dd = String(today.getDate()).padStart(2, '0');
            var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
            var yyyy = today.getFullYear();

            return yyyy + '-' + mm + '-' + dd;
        }

        // Set the value and max of the date fields to today's date
        var todayDate = getTodayDate();
        document.getElementById('entry-time').value = todayDate;
        document.getElementById('entry-time').max = todayDate;
        document.getElementById('exit-time').value = todayDate;
        document.getElementById('exit-time').max = todayDate;

        var submitEntryElement = document.getElementById('submit-entry');
        if (submitEntryElement) {
            submitEntryElement.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent form submission

                var form = document.getElementById('journal-form');
                if (!form.checkValidity()) {
                    form.reportValidity(); // Trigger the validation message
                    return; // If the form is not valid, stop here
                }

                var symbolName = document.getElementById('symbol-name').value;
                var entryTime = document.getElementById('entry-time').value;
                var exitTime = document.getElementById('exit-time').value;
                var entryPrice = parseFloat(document.getElementById('entry-price').value);
                var exitPrice = parseFloat(document.getElementById('exit-price').value);
                var side = document.getElementById('side').value;
                var question1 = document.getElementById('question-1').value;
                var question2 = document.getElementById('question-2').value;
                var question3 = document.getElementById('question-3').value;

                var profitLoss = side === 'long' ? exitPrice - entryPrice : entryPrice - exitPrice;

                var fullEntry = {
                    symbolName: symbolName,
                    entryTime: entryTime,
                    exitTime: exitTime,
                    entryPrice: entryPrice,
                    exitPrice: exitPrice,
                    side: side,
                    question1: question1,
                    question2: question2,
                    question3: question3,
                    profitLoss: profitLoss
                };

                // Save to local storage
                var entries = JSON.parse(localStorage.getItem('journalEntries')) || [];
                entries.push(fullEntry);
                localStorage.setItem('journalEntries', JSON.stringify(entries));

                // Clear the input fields
                document.getElementById('symbol-name').value = '';
                document.getElementById('entry-time').value = '';
                document.getElementById('exit-time').value = '';
                document.getElementById('entry-price').value = '';
                document.getElementById('exit-price').value = '';
                document.getElementById('side').value = '';
                document.getElementById('question-1').value = '';
                document.getElementById('question-2').value = '';
                document.getElementById('question-3').value = '';

                // Display entries
                displayEntries();
            });
        }

        var deleteSelectedElement = document.getElementById('delete-selected');
        if (deleteSelectedElement) {
            deleteSelectedElement.addEventListener('click', function() {
                var checkboxes = document.querySelectorAll('.entry input[type="checkbox"]');
                var entries = JSON.parse(localStorage.getItem('journalEntries')) || [];
                var newEntries = entries.filter(function(entry, index) {
                    return !checkboxes[index].checked;
                });
                localStorage.setItem('journalEntries', JSON.stringify(newEntries));
                displayEntries();
            });
        }

        var submitSelectedElement = document.getElementById('submit-selected');
        if (submitSelectedElement) {
            submitSelectedElement.addEventListener('click', function() {
                var selectedEntries = [];
                var checkboxes = document.querySelectorAll('.entry input[type="checkbox"]');
                checkboxes.forEach(function(checkbox, index) {
                    if (checkbox.checked) {
                        selectedEntries.push(checkbox.nextElementSibling.textContent);
                    }
                });
                downloadSelectedEntries(selectedEntries.join('\n'), 'selected_entries.txt');
            });
        }

        var selectAllElement = document.getElementById('select-all');
        if (selectAllElement) {
            selectAllElement.addEventListener('click', function() {
                var checkboxes = document.querySelectorAll('.entry input[type="checkbox"]');
                checkboxes.forEach(function(checkbox) {
                    checkbox.checked = true;
                });
            });
        }

        // Add event listener to toggle dark mode
        var toggleDarkModeElement = document.getElementById('toggle-dark-mode');
        if (toggleDarkModeElement) {
            toggleDarkModeElement.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
            });
        }

        // Function to download selected entries
        function downloadSelectedEntries(data, filename) {
            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(data));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        function displayEntries() {
            var entries = JSON.parse(localStorage.getItem('journalEntries')) || [];
            var entriesHtml = entries.map(function(entry, index) {
                // Formatting the entry into a readable string
                var entryText = `
                    Symbol: ${entry.symbolName} <br>
                    Entry Time: ${entry.entryTime} <br>
                    Exit Time: ${entry.exitTime} <br>
                    Entry Price: ${entry.entryPrice} <br>
                    Exit Price: ${entry.exitPrice} <br>
                    Side: ${entry.side} <br>
                    Profit/Loss: ${entry.profitLoss ? entry.profitLoss.toFixed(2) : 'N/A'} <br>
                    Feelings: ${entry.question1} <br>
                    Strategy: ${entry.question2} <br>
                    Opinion: ${entry.question3} <br>
                `;

                return '<div class="entry"><input type="checkbox" id="entry-' + index + '"><label for="entry-' + index + '">' + entryText + '</label></div>';
            }).join('');
            document.getElementById('past-entries').innerHTML = entriesHtml;
        }
        
        // Load entries on page load
        window.onload = function() {
            displayEntries();
            setDailyReminder(); // Call this function when the script loads
            // ... other code ...
        };

        function setDailyReminder() {
            var now = new Date();
            var nextReminder = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
            var timeout = nextReminder - now;
            setTimeout(function() {
                alert("Don't forget to write in your journal!");
                setDailyReminder(); // Set the next reminder
            }, timeout);
        }
        setDailyReminder();
    </script>
</body>
</html>
